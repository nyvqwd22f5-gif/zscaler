# Setting Up Cloud Deception with Microsoft Azure
Source: https://help.zscaler.com/deception/setting-cloud-deception-microsoft-azure
PDF: https://help.zscaler.com/pdf/com/en/1531507.pdf

This integration guide provides information on prerequisites and how to integrate Microsoft Azure with Zscaler Deception to set up Cloud Deception by deploying various Azure-specific decoy resources.
Prerequisites
Before you set up Cloud Deception with Azure, ensure that you have:
- A Microsoft Azure Account with a valid subscription.
- An Azure user with Cloud Device Administrator and Global Administrator roles to run the [deployment script](/deception/understanding-functions-azure-deployment-script).
- Enabled the **Restrict access to Azure AD administration portal** option under [User settings](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions). This restricts decoy users from accessing the administrator portal.
- Microsoft.Web and Microsoft.Insights are registered under resource providers in your subscriptions.
Setting Up Cloud Deception
Follow these steps to set up Cloud Deception with Microsoft Azure:
- [Step 1: Configure the Integration between Azure and Deception](#zd-integration-azure-decoys)
- [Step 2: Configure the Azure Decoys](#zd-azure-decoys-setup)
- [Step 3: Configure Lures Using Azure Decoys](#zd-lures-azure)
[]To integrate Microsoft Azure with Deception:
- Log in to the Zscaler Deception Admin Portal.
- Go to **Deceive **> **Cloud Deception **> **Azure **> **Settings**.
-
On the **Settings **page, click **Add Account**.
The **Azure Account Setting** window appears.
- In the **Azure Account Setting** window:
- **Enabled**: Select to enable the Azure account.
- **Region**: Select the region of your Azure account from the drop-down menu.
- **Subscription ID**: Enter the subscription ID of your Azure account.
- **Tenant ID**: Enter the Azure tenant ID.
-
**Decoy Manager Resource Group**: Enter a name for the group to hold all necessary resources other than decoys to support Cloud Deception functionalities.
[See image.](#zd-azure-settings)
- Click **Save.**
-
After the settings are updated, click **Download Deployment Script**.
[See image.](#deployment-script-button)
- In the **Download Deployment Script** window, obtain the PowerShell command using one of the following methods:
- [Automated Download Method](#zd-direct-download-script-setup)
- [Manual Download Method](#zd-manual-download-script-setup)
- Sign in to the [Azure Portal](http://https//portal.azure.com) as a user with the roles mentioned in the [prerequisites section](#zd-prerequisites-azure-setup).
-
Launch Cloud Shell by clicking the **Cloud Shell **icon on the top navigation bar.
[See image.](#zd-launch-powershell-azure-setup-another)
The **Cloud Shell **window appears.
-
In the **Cloud Shell **window:
- Set your shell environment to PowerShell.
- Run the deployment script using the command obtained via the [automated download method](/deception/obtaining-deployment-script-azure#zd-direct-download-script) or [manual download method](/deception/obtaining-deployment-script-azure#zd-manual-download-script).
- Enter the option to sync settings and press `Enter`.
[See image.](#zd-run-script-setup-azure)
Upon successful execution of the script, all necessary resources are created in Azure and the information is communicated to the Deception Admin Portal. The script also installs a health function app that polls the Azure account every 15 minutes to check and update the health status of the deployed decoys. The following table lists all resources created or fetched on Azure by the deployment script:
| Resource | Description |
| -------- | ----------- |
| Decoy Manager Resource Group | A resource group created by the deployment script in Azure to hold all necessary resources other than decoys to support Cloud Deception functionalities. |
| Client ID | A client ID assigned by Azure for decoy resources. |
| Client Secret | A secret value generated by Azure for decoy resources. |
| Logging Storage Account | A storage account created by deployment script for logging purposes. |
| Decoys Health Check Function App | A function app installed by the deployment script for monitoring and updating the health status of the deployed decoys. |
| Decoy Access Role | A role in Azure created by the deployment app to define access control for decoys. |
| App Service Plan | An app service plan created for decoy app services. |
You can set up and manage Cloud Deception for Azure separately based on the combination of Tenant ID and Subscription ID. For example, you can add multiple accounts that share the same Tenant ID but have different Subscription IDs.
[]After successful integration of Azure with Deception, you can deploy various Azure-specific decoy resources. To learn how to configure the Azure decoys, see:
- [User Decoys](/deception/creating-user-decoy-azure)
- [Service Principal Decoys](/deception/creating-service-principal-decoy-azure)
- [Managed Identity Decoys](/deception/creating-managed-identity-decoy-azure)
- [App Service Decoys](/deception/creating-app-service-decoy-azure)
- [Storage Account Container Decoys](/deception/creating-storage-account-container-decoy-azure)
- [Storage Account File Share Decoys](/deception/creating-storage-account-file-share-decoy-azure)
- [Key Vault Decoys](/deception/creating-key-vault-decoy-azure)
- [ARM Template Decoys](/deception/creating-arm-template-decoy-azure)
- [Container Registry Decoys](/deception/creating-container-registry-decoy-azure)
- [VM Image Decoys](/deception/creating-vm-image-decoy-azure)
- [Gen AI Decoys](/deception/creating-gen-ai-decoy-azure)
[]After deploying the necessary decoys based on your requirements, you can configure the lures for the decoys. To learn how to configure lures using Azure decoys, see [Configuring Lures Using Azure Decoys](/deception/configuring-lures-using-azure-decoys).
[]Using this method, you can obtain a PowerShell command that automatically downloads and runs the deployment script when executed via Azure's Cloud Shell. To obtain the command, copy the command from the **Automated: Run the following command in Azure Cloud Shell** section and save it for later use.
[See image.](#zd-download-script-window-direct-setup)
[]Using this method, you can download the deployment script as a PSM1 file, upload it to the Azure cloud, and run the script using a PowerShell command obtained from the Deception Admin Portal. To obtain the command and script:
- In the **Download Script Deployment** window:
-
Click **Download**.
[See image.](#zd-script-download-setup)
The deployment script is downloaded to your system.
-
Copy the command from the **Manual: Download the script and run the following command in Azure Cloud Shell** section, and save it for later use.
[See image.](#zd-download-script-window-manual-setup)
- Sign in to the [Azure Portal](https://portal.azure.com/) as a user with the roles mentioned in [the prerequisite section](http://zd-prerequisites-azure-setup/).
-
Click the **Cloud Shell** icon on the top navigation bar.
[See image.](#zd-launch-powershell-azure-setup)
- In the **Cloud Shell** window:
-
Click the **Upload/Download Files **icon, then select **Upload**.
[See image.](#zd-azure-upload-setup)
- Choose the deployment script file (.psm1) that you downloaded to your system to upload it to Azure.
[]![A screeshot capturing the Azure Settings Tab with the Download Deployment Script highlighted](/downloads/deception/deceive/cloud-deception/aws/setting-cloud-deception-aws/deception-cloud-deception-azure-deploymentscript-button.png)
[]![A screeshot capturing the Azure Settings Tab with the Save button highlighted](/downloads/deception/deceive/cloud-deception/aws/setting-cloud-deception-aws/deception-azure-account-setting-page_0.png)
[]![A screenshot capturing the Download Deployment Script window](/downloads/deception/deceive/cloud-deception/azure/setting-cloud-deception-microsoft-azure/zscaler-deception-copy-azure-script-automated.png)
[]![A screenshot capturing the option to download deployment script](/downloads/deception/deceive/cloud-deception/azure/setting-cloud-deception-microsoft-azure/zscaler-deception-download-azure-script-manual.png)
[]![A screenshot capturing the Download Deployment Script window](/downloads/deception/deceive/cloud-deception/azure/setting-cloud-deception-microsoft-azure/zscaler-deception-copy-azure-script-manual.png)
[]![A screenshot capturing the option to launch PowerShell in Azure](/downloads/deception/deceive/cloud-deception/azure-decoys/prerequisites-azure-decoy-deployment/zscaler-deception-azure-powershell-launch.png)
[]![A screenshot capturing file upload option on Azure Cloud Shell](/downloads/deception/deceive/cloud-deception/azure-decoys/prerequisites-azure-decoy-deployment/zd-azure-shell-upload.png)
[]![A screenshot capturing the option to launch PowerShell in Azure](/downloads/deception/deceive/cloud-deception/azure-decoys/prerequisites-azure-decoy-deployment/zscaler-deception-azure-powershell-launch.png)
[]![A screenshot capturing the deployment script running in Azure PowerShell](/downloads/deception/deceive/cloud-deception/azure-decoys/zscaler-deception-azure-powershell-script-run-settings.png)