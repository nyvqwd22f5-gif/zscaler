# Running the Decoy Deployment Script on an Active Directory
Source: https://help.zscaler.com/deception/running-decoy-deployment-script-active-directory
PDF: https://help.zscaler.com/pdf/com/en/1531336.pdf

To create decoy user accounts and computers in an Active Directory (AD), you must download the decoy deployment script from the Zscaler Deception Admin Portal and run it on the AD. You must run the deployment script to create user accounts in both the credential and credential-less modes.
Prerequisites
Make sure that the following prerequisites are met:
- Have admin access to the primary domain controller to run the script.
- Have Powershell version 3.0 or later on your system.
- Install PSReadLine on the AD server to read user inputs.
Running the Decoy Deployment Script on an AD
Follow these steps to run a deployment script on an AD:
- [Step 1: Configure the Group Policy Management Security Settings on a Domain Controller](#config-group-policy-management-settings)
- [Step 2: Download the Deployment Script from the Deception Admin Portal](#download-deployment-script)
- [Step 3: Run the Deployment Script](#run-deployment-script)
- []Press the `Windows key+R` on your system.
-
In the **Run** window, enter `gpmc.msc` to open the Group Policy Management console.
[See image.](#run-gpmc)
- Configure the security audit policy:
-
Right-click **Default Domain Controllers Policy** and select **Edit** from the drop-down menu.
[See image.](#config-domain-controller-policy)
-
Go to **Computer Configuration** > **Policies** > **Windows Settings** > **Security Settings** > **Advanced Audit Policy Configuration** > **Audit Policies** > **Logon/Logoff**.
[See image.](#navigate-advanced-audit-policy-gpmc)
- In the **Logon/Logoff** pane, double-click **Audit Logon**.
- In the **Audit Logon Properties** window, select the **Configure the following events**, **Success**, and **Failure** checkboxes.
-
Click **OK**.
[See image.](#config-logon-policy-gpmc)
- Enable Kerberos detection:
- Go to **Advanced Audit Policy Configuration** > **Audit Policies** > **Account Logon**.
- In the **Account Logon** pane, double-click **Audit Kerberos Authentication Service**.
- In the **Audit Kerberos Authentication Service Properties** window, select the **Configure the following events**, **Success**, and **Failure** checkboxes.
-
Click **OK**.
[See image.](#config-kerberos-auth-service)
- In the **Account Logon** pane, double-click **Audit Kerberos Service Ticket Operations**.
- In the **Audit Kerberos Service Ticket Operations Properties** window, select the **Configure the following events**, **Success**, and **Failure** checkboxes.
-
Click **OK**.
[See image.](#config-Kerberos-service-ticket-ops)
- Enable AD enumeration:
- Go to **Advanced Audit Policy Configuration** > **Audit Policies** > **DS Access**.
- In the **DS Access** pane, double-click **Audit Directory Service Access**.
- In the **Audit Directory Service Access Properties** window, select the **Configure the following events**, **Success**, and **Failure** checkboxes.
-
Click **OK**.
[See image.](#configure-directory-service-access)
Enabling the logs increases the volume of logs generated by the AD.
- []In the Deception Admin Portal, go to **Deceive** > **Active Directory Decoys** > **Decoy Users**.
-
Select an AD decoy user and click **Download Deployment Script**.
[See image.](#download-deploy-script)
- []Copy the deployment script `(Start-Deployment.ps1)`to the primary domain controller.
- Open PowerShell on the primary domain controller with administrative privileges.
- Go to the path where the deployment script is saved.
-
Run the script on the primary domain controller using the following commands:
- `Unblock-File .\Start-Deployment.ps1`
- `Import-Module .\Start-Deployment.ps1`
- `Start-Deployment`
The deployment script tests the configured audit policies for all the primary domain controllers and displays the results in green text.
[See image.](#run-deployment-script-powershell)
-
Enter `1` to create a decoy user.
[See image.](#0ption-1-create-decoy-user)
-
After the decoy user is created, enter `7` to verify the decoy deployment.
[See image.](#option-7-verify-deployment)
-
Enter `8` to generate the deployment JSON file.
The script tries to upload the JSON file directly to the Deception Admin Portal.
[See image.](#option-8-script-json-admin-portal)
If the script fails to upload the JSON file to the Deception Admin Portal, then the script writes the JSON file to your local computer (to the same folder where the deployment script is located). In this case, you must upload the JSON file to the Deception Admin Portal.
[See image.](#option-8-script-saves-local-computer)
To upload the deployment JSON file to the Deception Admin Portal:
- []Log in to the Deception Admin Portal.
- Go to **Deceive** > **Active Directory Decoys** > **Decoy Users**.
-
Click **Actions** > **Upload Enumeration Detection JSON**.
[See image.](#upload-enumeration-detection-json)
- Browse to upload the JSON file.
-
In the confirmation window, click **OK**.
The deployment JSON is uploaded.
[]![Run the gpmc.msc command](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-run-gpmc.png)
[]![Edit domain controller policy](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-configure-domain-controller-policy.png?1655447198)
[]![Navigate to Advanced Audit Policy Configuration in GPMC](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-audit-policy-navigation.png)
[]![Configure the logon policy in the GPMC](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-configure-logon-policy.png?1655447761)
[]![Configure Kerberos authentication service ](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-configure-kerberose-auth-service.png)
[]![Configure Kerberos service ticket operation properties](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-configure-kerberose-service-ticket.png)
[]![Configure directory service access](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-configure-directory-service-access.png)
[]![Download AD decoy deployment script](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-ad-decoys-download-decoy-script-2.png)
[]![Run the deployment script](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-run-deployment-script.png)
[]![Option 1 to create a decoy user](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-opt-1-create-decoy-user.png)
[]![Option 7 to verify deployment](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-opt-7-verify-deployment.png)
[]![The script uploads the JSON file to the Zscaler Deception Admin Portal](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-scipt-uploads-json-admin-portal.png?1655457796)
[]![The script writes the JSON file to the local computer](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-scipt-saves-json-local-computer.png?1655457857)
[]![Upload enumeration detection JSON](/downloads/deception/deceive/active-directory-decoys/running-decoy-deployment-script-active-directory/zscaler-deception-ad-decoys-upload-enum-det-2.png)